name: Whitelist Blacklist Automation v3
on:
  workflow_dispatch:

jobs:
  run_blacklist3:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: ğŸ“¥ Checkout Code
        uses: actions/checkout@v4
        with:
          ref: main
          fetch-depth: 0

      - name: ğŸ”„ Sync Latest Code
        run: git fetch --prune && git reset --hard origin/main

      - name: ğŸ Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: ğŸ“¦ Install FFmpeg
        run: sudo apt-get update && sudo apt-get install -y ffmpeg

      - name: ğŸ“ Create Output Directory
        run: mkdir -p assets/blacklist3/

      - name: ğŸ” Execute Detection Script
        run: python assets/blacklist3/blacklist3.py

      - name: ğŸ’¾ Commit Results
        run: |
          git config --global user.email "actions@github.com"
          git config --global user.name "GitHub Actions Bot"
          
          git add assets/blacklist3/result.txt
          
          if git diff --staged --quiet; then
            echo "â„¹ï¸ No changes detected"
            exit 0
          fi
          
          git commit -m "ğŸ›¡ï¸ $(date +'%Y-%m-%d %H:%M:%S')"
          
          git pull origin main --rebase --autostash || {
            echo "ğŸ”„ Rebase failed, force syncing"
            git reset --hard origin/main
          }
          
          git push origin main --force-with-lease || git push origin main --force
          echo "âœ… Results pushed successfully"